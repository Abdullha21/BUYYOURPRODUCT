<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Save Money Account</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Hind Siliguri',sans-serif; }
        body { background:linear-gradient(135deg,#0a0f1a,#121a2e); color:#e0e0e0; min-height:100vh; padding:15px; line-height:1.6; }
        .container { max-width:1000px; margin:0 auto; }
        .card { background:rgba(26,30,46,0.92); padding:25px; border-radius:16px; box-shadow:0 10px 40px rgba(0,255,136,0.12); margin-bottom:20px; border:1px solid rgba(0,255,136,0.18); backdrop-filter:blur(6px); }
        h1,h2,h3 { color:#00ff88; text-align:center; margin-bottom:20px; text-shadow:0 0 10px rgba(0,255,136,0.4); }
        input,textarea,select,button { width:100%; padding:12px; margin:8px 0; border:none; border-radius:10px; background:#1e2535; color:white; font-size:16px; transition:all 0.3s ease; }
        input:focus,textarea:focus,select:focus { outline:2px solid #00ff88; background:#252f44; box-shadow:0 0 15px rgba(0,255,136,0.3); }
        button { background:linear-gradient(90deg,#00ff88,#00cc70); color:black; font-weight:bold; cursor:pointer; transition:all 0.3s; }
        button:hover { transform:translateY(-3px); box-shadow:0 8px 20px rgba(0,255,136,0.4); }
        .logout-btn { background:linear-gradient(90deg,#ff4444,#cc0000); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-weight:bold; transition:all 0.3s; }
        .logout-btn:hover { transform:translateY(-3px); box-shadow:0 8px 20px rgba(255,68,68,0.4); }
        .hidden { display:none !important; }
        #calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin:20px 0; }
        .calendar-header { background:#1e2535; padding:12px; border-radius:10px; text-align:center; font-weight:bold; color:#00ff88; font-size:14px; }
        .day { background:#1e2535; padding:12px 8px; border-radius:12px; text-align:center; cursor:pointer; min-height:100px; transition:all 0.4s ease; position:relative; overflow:hidden; border:2px solid transparent; }
        .day:hover { transform:scale(1.04); border-color:#00ff88; box-shadow:0 0 20px rgba(0,255,136,0.3); }
        .day.today { border:2px solid #00ff88; background:#142022; transform:scale(1.03); }
        .day.has-data { background:linear-gradient(135deg,#003320,#002211); transform:scale(1.06); box-shadow:0 0 25px rgba(0,255,136,0.5); animation:pulseGlow 2.5s infinite; }
        @keyframes pulseGlow { 0%{box-shadow:0 0 12px rgba(0,255,136,0.4);} 50%{box-shadow:0 0 30px rgba(0,255,136,0.8);} 100%{box-shadow:0 0 12px rgba(0,255,136,0.4);} }
        .day-number { font-size:18px; font-weight:bold; margin-bottom:5px; color:#ffffff; }
        .day-amount { font-size:12px; margin:3px 0; padding:2px 6px; border-radius:6px; background:rgba(0,0,0,0.4); }
        .day-source { font-size:10px; color:#bbb; margin-top:5px; word-break:break-all; }
        .month-nav { display:flex; justify-content:space-between; align-items:center; margin:20px 0; }
        .month-nav button { width:50px; padding:10px; background:#1e2535; color:#00ff88; font-size:20px; border-radius:10px; }
        .month-nav button:hover { background:#2a344a; }
        .summary p { font-size:1.2em; margin:10px 0; padding:10px; background:#1e2535; border-radius:10px; }
        .profit { font-size:1.6em !important; font-weight:bold; color:#00ff88 !important; background:#142022 !important; padding:15px !important; border-radius:12px; box-shadow:0 0 15px rgba(0,255,136,0.3); }
        .loss { color:#ff4444 !important; background:#2a1a1a !important; }
        .modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.92); overflow:auto; }
        .modal-content { background:#1a1e2e; margin:5% auto; padding:30px; width:90%; max-width:520px; border-radius:16px; border:2px solid #00ff88; box-shadow:0 0 40px rgba(0,255,136,0.25); }
        .close { position:absolute; top:10px; right:20px; font-size:38px; cursor:pointer; color:#aaa; transition:0.3s; }
        .close:hover { color:#ff4444; }
        .delete-btn { background:linear-gradient(90deg,#ff4444,#cc0000); margin-top:15px; }
        .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; flex-wrap:nowrap; }
        .logo-title { display:flex; align-items:center; gap:12px; }
        .logo { font-size:36px; }
        .app-name { font-size:1.7em; color:#00ff88; white-space:nowrap; }
        .hamburger { font-size:36px; background:none; border:none; color:#00ff88; cursor:pointer; padding:6px 12px; border-radius:50%; transition:all 0.3s; margin-left:auto; }
        .hamburger:hover { background:rgba(0,255,136,0.18); transform:scale(1.15); }
        .side-menu { position:fixed; top:0; right:-320px; width:320px; height:100%; background:rgba(26,30,46,0.98); border-left:2px solid #00ff88; box-shadow:-12px 0 35px rgba(0,255,136,0.25); transition:right 0.4s ease; z-index:2000; padding:25px; color:#e0e0e0; backdrop-filter:blur(8px); overflow-y:auto; }
        .side-menu.open { right:0 !important; }
        .side-menu-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:35px; }
        .side-menu-header h2 { margin:0; color:#00ff88; font-size:1.6em; }
        .side-menu ul { list-style:none; padding:0; margin:0; }
        .side-menu li { padding:18px 0; border-bottom:1px solid #2a344a; cursor:pointer; transition:all 0.3s; font-size:1.1em; }
        .side-menu li:hover { color:#00ff88; padding-left:15px; }
        .side-menu .logout-section { position:absolute; bottom:40px; left:25px; right:25px; }
        .overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.75); z-index:1500; display:none; }
        .overlay.show { display:block; }
        .developer-credit { position:fixed; bottom:0; left:0; right:0; background:rgba(26,30,46,0.95); color:#888; text-align:center; padding:12px; font-size:14px; border-top:1px solid #00ff88; z-index:999; backdrop-filter:blur(10px); }
        .developer-credit a { color:#00ff88; text-decoration:none; font-weight:bold; transition:0.3s; }
        .developer-credit a:hover { color:#ffffff; text-shadow:0 0 12px #00ff88; }
        @media (max-width:768px) { .hamburger { font-size:30px; } .side-menu { width:280px; padding:20px; } .app-name { font-size:1.4em; } }
    </style>
</head>
<body>

    <div class="overlay" id="overlay" onclick="closeSideMenu()"></div>

    <div class="side-menu" id="sideMenu">
        <div class="side-menu-header">
            <h2>‡¶Æ‡ßá‡¶®‡ßÅ</h2>
            <span class="close" onclick="closeSideMenu()">√ó</span>
        </div>
        <ul>
            <li onclick="openLastMonthReport()">‡¶¨‡¶ø‡¶ó‡¶§ ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</li>
            <li>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</li>
            <li onclick="openExportPage()">‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶°‡¶æ‡¶ü‡¶æ</li>
            <li><a href="https://t.me/abdullha2" target="_blank" style="color:inherit; text-decoration:none; display:block;">‡¶π‡ßá‡¶≤‡ßç‡¶™ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶° ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</a></li>
        </ul>
        <div class="logout-section">
            <button class="logout-btn" onclick="logout()" style="width:100%;">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button>
        </div>
    </div>

    <div class="container">
        <div id="loginSection" class="card">
            <h2>‡¶≤‡¶ó‡¶á‡¶® / ‡¶∏‡¶æ‡¶á‡¶®‡¶Ü‡¶™</h2>
            <div class="error" id="loginError"></div>
            <div class="success" id="loginSuccess"></div>
            <div class="form-group">
                <label for="email">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label>
                <input type="email" id="email" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ">
            </div>
            <div class="form-group">
                <label for="password">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                <input type="password" id="password" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
            </div>
            <button onclick="login()">‡¶≤‡¶ó‡¶á‡¶®</button>
            <button onclick="signup()">‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <div class="loader" id="authLoader"></div>
        </div>

        <div id="appSection" class="hidden">
            <div class="header">
                <div class="logo-title">
    <img src="https://uploads.onecompiler.io/42weeh2u8/44afppfx3/1000029290.png" alt="Logo" class="logo-img" style="height:50px; width:auto;">
    <span class="app-name">Calendar Save Money Account</span>
                </div>
                <button class="hamburger" onclick="openSideMenu()">‚ò∞</button>
            </div>
            
            <div class="card">
                <div class="month-nav">
                    <button onclick="prevMonth()">‚Üê</button>
                    <h2 id="monthYear"></h2>
                    <button onclick="nextMonth()">‚Üí</button>
                </div>
                <div id="calendar"></div>
            </div>
            
            <div class="summary card">
                <h3>‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h3>
                <p>‡¶Æ‡ßã‡¶ü ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ: <span id="totalIncome">0.00</span> USDT</p>
                <p>‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö: <span id="totalExpense">0.00</span> USDT</p>
                <p>‡¶Æ‡ßã‡¶ü ‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü: <span id="totalInvest">0.00</span> USDT</p>
                <p class="profit" id="profitLoss">‡¶≤‡¶æ‡¶≠/‡¶≤‡¶∏: 0.00 USDT</p>
            </div>
        </div>
    </div>

    <!-- Day Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">√ó</span>
            <h3 id="modalDate"></h3>
            <div class="error" id="modalError"></div>
            
            <div class="form-group">
                <label for="income">‡¶á‡¶®‡¶ï‡¶æ‡¶Æ (USDT)</label>
                <input type="number" step="0.01" id="income" placeholder="‡¶á‡¶®‡¶ï‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
            </div>
            
            <div class="form-group">
                <label for="incomeSource">‡¶á‡¶®‡¶ï‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶â‡ßé‡¶∏</label>
                <input type="text" id="incomeSource" placeholder="‡¶ï‡ßã‡¶•‡¶æ ‡¶•‡ßá‡¶ï‡ßá? (Binance, Referral...)" list="incomeSources">
            </div>
            
            <div class="form-group">
                <label for="expense">‡¶ñ‡¶∞‡¶ö (USDT)</label>
                <input type="number" step="0.01" id="expense" placeholder="‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
            </div>
            
            <div class="form-group">
                <label for="expenseCategory">‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶ß‡¶∞‡¶£</label>
                <input type="text" id="expenseCategory" placeholder="‡¶ï‡ßã‡¶•‡¶æ‡ßü ‡¶ñ‡¶∞‡¶ö? (Food, Fee...)" list="expenseCategories">
            </div>
            
            <div class="form-group">
                <label for="invest">‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü (USDT)</label>
                <input type="number" step="0.01" id="invest" placeholder="‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
            </div>
            
            <div class="form-group">
                <label for="investPlatform">‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ</label>
                <input type="text" id="investPlatform" placeholder="‡¶ï‡ßã‡¶•‡¶æ‡ßü ‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü? (Staking, Futures...)" list="investPlatforms">
            </div>
            
            <div class="form-group">
                <label for="note">‡¶®‡ßã‡¶ü</label>
                <textarea id="note" rows="3" placeholder="‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶®‡ßã‡¶ü"></textarea>
            </div>
            
            <button onclick="saveDay()">üíæ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button class="delete-btn" id="deleteBtn" onclick="deleteDay()" style="display:none;">üóëÔ∏è ‡¶°‡ßá‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <!-- Datalists -->
    <datalist id="incomeSources">
        <option value="Binance">
        <option value="Bybit">
        <option value="OKX">
        <option value="Referral">
        <option value="YouTube">
        <option value="Telegram">
        <option value="Airdrop">
        <option value="Trading">
        <option value="Staking">
        <option value="Freelancing">
    </datalist>
    
    <datalist id="expenseCategories">
        <option value="Food">
        <option value="Rent">
        <option value="Ads">
        <option value="Fee">
        <option value="Withdrawal">
        <option value="Gift">
        <option value="Shopping">
        <option value="Transport">
        <option value="Bills">
    </datalist>
    
    <datalist id="investPlatforms">
        <option value="Staking">
        <option value="Futures">
        <option value="Spot">
        <option value="Node">
        <option value="Launchpad">
        <option value="Liquidity Pool">
        <option value="Savings">
    </datalist>

    <div class="developer-credit">
        <span class="developer-logo">üöÄ</span>
        <strong>Developed by</strong> 
        <a href="https://t.me/abdullha2" target="_blank">Abdullah Khan</a>
        <span class="version">v1.0.9</span>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDocs, deleteDoc, query, where, Timestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCOfdNrWquXTJE1t04P3BHqRa5iCI8jHK0",
            authDomain: "calendar-888d2.firebaseapp.com",
            projectId: "calendar-888d2",
            storageBucket: "calendar-888d2.firebasestorage.app",
            messagingSenderId: "778995585586",
            appId: "1:778995585586:web:885962728d935d7c1da22b",
            measurementId: "G-JHKNCR2WTS"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let currentMonth = new Date();
        let selectedDate = null;
        let monthlyData = {};

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('appSection').classList.remove('hidden');
                loadAndRender();
            } else {
                currentUser = null;
                document.getElementById('loginSection').classList.remove('hidden');
                document.getElementById('appSection').classList.add('hidden');
            }
        });

        function showLoader(id) { document.getElementById(id).style.display = 'block'; }
        function hideLoader(id) { document.getElementById(id).style.display = 'none'; }

        function showMessage(type, id, message) {
            const el = document.getElementById(id);
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }

        window.login = async () => {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            if (!email || !password) return showMessage('error', 'loginError', '‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®');
            showLoader('authLoader');
            try {
                await signInWithEmailAndPassword(auth, email, password);
                showMessage('success', 'loginSuccess', '‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!');
            } catch (error) {
                showMessage('error', 'loginError', error.message);
            } finally { hideLoader('authLoader'); }
        };

        window.signup = async () => {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            if (!email || !password) return showMessage('error', 'loginError', '‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®');
            if (password.length < 6) return showMessage('error', 'loginError', '‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá');
            showLoader('authLoader');
            try {
                await createUserWithEmailAndPassword(auth, email, password);
                showMessage('success', 'loginSuccess', '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶∏‡¶´‡¶≤!');
            } catch (error) {
                showMessage('error', 'loginError', error.message);
            } finally { hideLoader('authLoader'); }
        };

        window.logout = async () => {
            try {
                await signOut(auth);
                closeSideMenu();
                showMessage('success', 'loginSuccess', '‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶∏‡¶´‡¶≤!');
            } catch (error) { console.error('Logout error:', error); }
        };

        const loadAndRender = async () => {
            if (!currentUser) return;
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            document.getElementById('monthYear').textContent = currentMonth.toLocaleDateString('bn-BD', { month: 'long', year: 'numeric' });
            const start = new Date(year, month, 1);
            const end = new Date(year, month + 1, 0, 23, 59, 59);
            monthlyData = {};
            try {
                const q = query(collection(db, 'users', currentUser.uid, 'days'),
                    where('timestamp', '>=', Timestamp.fromDate(start)),
                    where('timestamp', '<=', Timestamp.fromDate(end)));
                const snapshot = await getDocs(q);
                snapshot.forEach(doc => monthlyData[doc.id] = doc.data());
                renderCalendar();
                updateSummary();
            } catch (error) { console.error('Error loading data:', error); }
        };

        const renderCalendar = () => {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date().toISOString().slice(0, 10);
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';
            ['‡¶∞‡¶¨‡¶ø','‡¶∏‡ßã‡¶Æ','‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤','‡¶¨‡ßÅ‡¶ß','‡¶¨‡ßÉ‡¶π‡¶É','‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞','‡¶∂‡¶®‡¶ø'].forEach(d => {
                const h = document.createElement('div');
                h.className = 'calendar-header';
                h.textContent = d;
                calendar.appendChild(h);
            });
            for (let i = 0; i < firstDay; i++) calendar.appendChild(document.createElement('div'));
            let ti=0, te=0, tiv=0;
            for (let d = 1; d <= daysInMonth; d++) {
                const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const data = monthlyData[dateStr] || {};
                const el = document.createElement('div');
                el.className = 'day';
                const inc = data.income || 0;
                const exp = data.expense || 0;
                const inv = data.invest || 0;
                ti += inc; te += exp; tiv += inv;
                let html = `<div class="day-number">${d}</div>`;
                if (inc > 0) html += `<div class="day-amount" style="color:#00ff88;">+${inc.toFixed(2)}</div>`;
                if (exp > 0) html += `<div class="day-amount" style="color:#ff4444;">-${exp.toFixed(2)}</div>`;
                if (inv > 0) html += `<div class="day-amount" style="color:#ff9500;">${inv.toFixed(2)}</div>`;
                if (data.incomeSource || data.expenseCategory || data.investPlatform) {
                    const srcs = [data.incomeSource, data.expenseCategory, data.investPlatform].filter(Boolean);
                    html += `<div class="day-source">${srcs.join(', ')}</div>`;
                }
                el.innerHTML = html;
                if (dateStr === today) el.classList.add('today');
                if (Object.keys(data).length > 0) el.classList.add('has-data');
                el.onclick = () => openModal(dateStr);
                calendar.appendChild(el);
            }
  document.getElementById('totalIncome').textContent = ti.toFixed(2);
            document.getElementById('totalExpense').textContent = te.toFixed(2);
            document.getElementById('totalInvest').textContent = tiv.toFixed(2);
            const tp = ti - te - tiv;
            const pEl = document.getElementById('profitLoss');
            pEl.textContent = `‡¶≤‡¶æ‡¶≠/‡¶≤‡¶∏: ${tp.toFixed(2)} USDT`;
            pEl.className = tp >= 0 ? 'profit' : 'profit loss';
        };

        const updateSummary = () => {
            let ti=0, te=0, tiv=0;
            Object.values(monthlyData).forEach(d => {
                ti += d.income || 0;
                te += d.expense || 0;
                tiv += d.invest || 0;
            });
            document.getElementById('totalIncome').textContent = ti.toFixed(2);
            document.getElementById('totalExpense').textContent = te.toFixed(2);
            document.getElementById('totalInvest').textContent = tiv.toFixed(2);
            const tp = ti - te - tiv;
            const pEl = document.getElementById('profitLoss');
            pEl.textContent = `‡¶≤‡¶æ‡¶≠/‡¶≤‡¶∏: ${tp.toFixed(2)} USDT`;
            pEl.className = tp >= 0 ? 'profit' : 'profit loss';
        };

        window.openModal = (date) => {
            selectedDate = date;
            const dt = new Date(date);
            document.getElementById('modalDate').textContent = dt.toLocaleDateString('bn-BD', {weekday:'long', year:'numeric', month:'long', day:'numeric'});
            const data = monthlyData[date] || {};
            document.getElementById('income').value = data.income || '';
            document.getElementById('incomeSource').value = data.incomeSource || '';
            document.getElementById('expense').value = data.expense || '';
            document.getElementById('expenseCategory').value = data.expenseCategory || '';
            document.getElementById('invest').value = data.invest || '';
            document.getElementById('investPlatform').value = data.investPlatform || '';
            document.getElementById('note').value = data.note || '';
            document.getElementById('deleteBtn').style.display = Object.keys(data).length > 0 ? 'block' : 'none';
            document.getElementById('modal').style.display = 'block';
        };

        window.saveDay = async () => {
            if (!currentUser) return;
            const income = parseFloat(document.getElementById('income').value) || 0;
            const expense = parseFloat(document.getElementById('expense').value) || 0;
            const invest = parseFloat(document.getElementById('invest').value) || 0;
            if (income === 0 && expense === 0 && invest === 0) return showMessage('error', 'modalError', '‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®');
            const data = {
                income,
                incomeSource: document.getElementById('incomeSource').value.trim(),
                expense,
                expenseCategory: document.getElementById('expenseCategory').value.trim(),
                invest,
                investPlatform: document.getElementById('investPlatform').value.trim(),
                note: document.getElementById('note').value.trim(),
                timestamp: Timestamp.fromDate(new Date(selectedDate))
            };
            try {
                await setDoc(doc(db, 'users', currentUser.uid, 'days', selectedDate), data);
                monthlyData[selectedDate] = data;
                closeModal();
                renderCalendar();
                updateSummary();
            } catch (error) {
                console.error('Error saving data:', error);
                showMessage('error', 'modalError', '‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            }
        };

        window.deleteDay = async () => {
            if (!currentUser || !confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶á ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) return;
            try {
                await deleteDoc(doc(db, 'users', currentUser.uid, 'days', selectedDate));
                delete monthlyData[selectedDate];
                closeModal();
                renderCalendar();
                updateSummary();
            } catch (error) {
                console.error('Error deleting data:', error);
                showMessage('error', 'modalError', '‡¶°‡ßá‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            }
        };

        window.closeModal = () => {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('modalError').style.display = 'none';
        };

        window.prevMonth = () => { currentMonth.setMonth(currentMonth.getMonth() - 1); loadAndRender(); };
        window.nextMonth = () => { currentMonth.setMonth(currentMonth.getMonth() + 1); loadAndRender(); };

        // ‡¶∏‡¶æ‡¶á‡¶° ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function openSideMenu() {
            const menu = document.getElementById('sideMenu');
            const overlay = document.getElementById('overlay');
            if (menu && overlay) {
                menu.classList.add('open');
                overlay.classList.add('show');
            }
        }

        function closeSideMenu() {
            const menu = document.getElementById('sideMenu');
            const overlay = document.getElementById('overlay');
            if (menu && overlay) {
                menu.classList.remove('open');
                overlay.classList.remove('show');
            }
        }

        function openLastMonthReport() {
            closeSideMenu();
            window.open('last-month-report.html', '_blank');
        }

        function openExportPage() {
            closeSideMenu();
            window.open('export-data.html', '_blank');
        }

        // ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
        document.addEventListener('DOMContentLoaded', () => {
            const hamburger = document.querySelector('.hamburger');
            if (hamburger) {
                hamburger.addEventListener('click', openSideMenu);
            }

            document.getElementById('overlay').addEventListener('click', closeSideMenu);

            document.getElementById('monthYear').textContent = currentMonth.toLocaleDateString('bn-BD', { month: 'long', year: 'numeric' });
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeSideMenu();
                closeModal();
            }
        });
    </script>
</body>
</html>
