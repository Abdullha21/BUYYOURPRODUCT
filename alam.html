<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USDT ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞ - Sound ‡¶∏‡¶π ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ</title>
    <style>
        /* ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ CSS */
        .alarm-section {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid #333;
        }
        
        .alarm-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .alarm-btn {
            background: #ff9500;
            margin: 10px 0;
            padding: 12px;
            border-radius: 8px;
            border: none;
            color: white;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: 0.3s;
        }
        
        .alarm-btn:hover {
            background: #e68500;
            transform: translateY(-2px);
        }
        
        .alarm-badge {
            background: red;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .alarm-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            overflow-y: auto;
        }
        
        .alarm-content {
            background: #1a1a1a;
            margin: 50px auto;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            border: 2px solid #ff9500;
        }
        
        .alarm-item {
            background: #2a2a2a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 5px solid #ff9500;
        }
        
        .alarm-time {
            color: #ff9500;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .alarm-reason {
            color: #00ff88;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .alarm-days {
            color: #aaa;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .alarm-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .delete-alarm {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff9500;
            color: black;
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            box-shadow: 0 5px 25px rgba(255,149,0,0.5);
            z-index: 9999;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification-title {
            font-weight: bold;
            font-size: 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification-message {
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .notification-actions {
            display: flex;
            gap: 10px;
        }
        
        .notification-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .snooze-btn {
            background: #2a2a2a;
            color: #00ff88;
            border: 2px solid #00ff88;
        }
        
        .close-btn {
            background: #ff4444;
            color: white;
        }
        
        .test-sound-btn {
            background: #00ff88;
            color: black;
            margin-top: 10px;
            padding: 10px;
            width: 100%;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .day-checkboxes {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .day-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #aaa;
        }
        
        .day-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        .sound-test {
            margin-top: 20px;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 10px;
            border: 1px solid #00ff88;
        }
        
        .sound-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .sound-btn {
            background: #333;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
        }
        
        .sound-btn:hover {
            background: #444;
        }
        
        .active-sound {
            background: #00ff88 !important;
            color: black !important;
        }
        
        .volume-control {
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .volume-slider {
            flex: 1;
            height: 8px;
            background: #333;
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #00ff88;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .alarm-ringing {
            animation: ring 0.5s infinite alternate;
        }
        
        @keyframes ring {
            0% { transform: rotate(-5deg); }
            100% { transform: rotate(5deg); }
        }
        
        .permission-warning {
            background: #ff4444;
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶∏‡¶¨ HTML ‡¶ï‡ßã‡¶° -->
        
        <!-- ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® -->
        <div class="alarm-section card">
            <div class="alarm-header">
                <h3 style="color:#ff9500;">üîî ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</h3>
                <button class="alarm-btn" onclick="openAlarmModal()">
                    ‚è∞ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®
                    <span id="activeAlarms" class="alarm-badge">0</span>
                </button>
            </div>
            
            <div class="permission-warning" id="permissionWarning">
                ‚ö†Ô∏è ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡¶ø‡¶®‡•§ ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶®‡¶æ ‡¶¶‡¶ø‡¶≤‡ßá ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶¨‡¶æ‡¶ú‡¶¨‡ßá ‡¶®‡¶æ‡•§
            </div>
            
            <div id="nextAlarmInfo" style="color:#aaa; font-size:14px; margin-top:10px; padding:10px; background:#2a2a2a; border-radius:8px;">
                ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ: ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
            </div>
            
            <div class="sound-test">
                <h4 style="color:#00ff88; margin-bottom:10px;">üîä Sound ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                <div class="sound-buttons" id="soundButtons">
                    <!-- Sound buttons will be added here -->
                </div>
                <div class="volume-control">
                    <span style="color:#aaa;">üîä ‡¶≠‡¶≤‡¶ø‡¶â‡¶Æ:</span>
                    <input type="range" min="0" max="100" value="50" class="volume-slider" id="volumeSlider" oninput="updateVolume()">
                    <span id="volumeValue" style="color:#00ff88; width:40px;">50%</span>
                </div>
            </div>
        </div>
        
        <!-- ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶∏‡¶¨ -->
    </div>
    
    <!-- ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶Æ‡¶°‡¶æ‡¶≤ -->
    <div id="alarmModal" class="alarm-modal">
        <div class="alarm-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="color:#ff9500; margin:0;">‚è∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ</h2>
                <button onclick="closeAlarmModal()" style="background:none; border:none; color:#aaa; font-size:30px; cursor:pointer;">√ó</button>
            </div>
            
            <div style="margin-bottom:15px;">
                <label style="color:#00ff88; display:block; margin-bottom:5px;">‡¶∏‡¶Æ‡ßü ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                <input type="time" id="alarmTime" style="width:100%; padding:12px; background:#2a2a2a; border:none; border-radius:8px; color:white; font-size:16px;">
            </div>
            
            <div style="margin-bottom:15px;">
                <label style="color:#00ff88; display:block; margin-bottom:5px;">‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£</label>
                <input type="text" id="alarmReason" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶ü‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶Ç ‡¶ü‡¶æ‡¶á‡¶Æ, ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ö‡ßá‡¶ï" style="width:100%; padding:12px; background:#2a2a2a; border:none; border-radius:8px; color:white; font-size:16px;">
            </div>
            
            <div style="margin-bottom:15px;">
                <label style="color:#00ff88; display:block; margin-bottom:5px;">‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶¨‡ßÉ‡¶§‡ßç‡¶§‡¶ø</label>
                <select id="alarmRepeat" style="width:100%; padding:12px; background:#2a2a2a; border:none; border-radius:8px; color:white; font-size:16px;">
                    <option value="once">‡¶è‡¶ï‡¶¨‡¶æ‡¶∞</option>
                    <option value="daily">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶®</option>
                    <option value="weekdays">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ï‡¶∞‡ßç‡¶Æ‡¶¶‡¶ø‡¶¨‡¶∏ (‡¶∏‡ßã‡¶Æ-‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞)</option>
                    <option value="weekends">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï ‡¶õ‡ßÅ‡¶ü‡¶ø (‡¶∂‡¶®‡¶ø-‡¶∞‡¶¨‡¶ø)</option>
                    <option value="weekly">‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï</option>
                    <option value="custom">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶¶‡¶ø‡¶®</option>
                </select>
            </div>
            
            <div id="customDays" style="display:none; margin-bottom:15px;">
                <label style="color:#00ff88; display:block; margin-bottom:5px;">‡¶¶‡¶ø‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                <div class="day-checkboxes">
                    <label class="day-checkbox">
                        <input type="checkbox" name="day" value="0"> ‡¶∞‡¶¨‡¶ø
                    </label>
                    <label class="day-checkbox">
                        <input type="checkbox" name="day" value="1"> ‡¶∏‡ßã‡¶Æ
                    </label>
                    <label class="day-checkbox">
                        <input type="checkbox" name="day" value="2"> ‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤
                    </label>
                    <label class="day-checkbox">
                        <input type="checkbox" name="day" value="3"> ‡¶¨‡ßÅ‡¶ß
                    </label>
                    <label class="day-checkbox">
                        <input type="checkbox" name="day" value="4"> ‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø
                    </label>
                    <label class="day-checkbox">
                        <input type="checkbox" name="day" value="5"> ‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞
                    </label>
                    <label class="day-checkbox">
                        <input type="checkbox" name="day" value="6"> ‡¶∂‡¶®‡¶ø
                    </label>
                </div>
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="color:#00ff88; display:block; margin-bottom:5px;">Sound ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                <select id="alarmSound" style="width:100%; padding:12px; background:#2a2a2a; border:none; border-radius:8px; color:white; font-size:16px;">
                    <option value="classic">‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡¶ø‡¶ï ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ</option>
                    <option value="digital">‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ</option>
                    <option value="beep">‡¶¨‡¶ø‡¶™ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ</option>
                    <option value="bell">‡¶¨‡ßá‡¶≤ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ</option>
                    <option value="chime">‡¶ö‡¶æ‡¶á‡¶Æ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ</option>
                    <option value="siren">‡¶∏‡¶æ‡¶á‡¶∞‡ßá‡¶®</option>
                </select>
            </div>
            
            <button onclick="saveAlarm()" style="background:#00ff88; color:black; padding:15px; width:100%; border:none; border-radius:8px; font-size:18px; cursor:pointer; font-weight:bold; margin-bottom:20px;">
                üíæ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
            
            <button onclick="testSelectedSound()" class="test-sound-btn">
                üîä ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® Sound ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
            
            <h3 style="color:#00ff88; margin:25px 0 15px 0; border-bottom:2px solid #00ff88; padding-bottom:10px;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ó‡ßÅ‡¶≤‡ßã</h3>
            
            <div id="alarmList" style="max-height:300px; overflow-y:auto;">
                <!-- ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü -->
            </div>
        </div>
    </div>
      <!-- Sound ‡¶´‡¶æ‡¶á‡¶≤ ‡¶ó‡ßÅ‡¶≤‡ßã -->
    <audio id="soundClassic" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-classic-alarm-995.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundDigital" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-digital-clock-digital-alarm-buzzer-992.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundBeep" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundBell" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-bell-notification-933.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundChime" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-morning-clock-alarm-1003.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundSiren" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-siren-alert-994.mp3" type="audio/mpeg">
    </audio>
    
    <!-- ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞ -->
    <audio id="currentAlarmSound" preload="auto"></audio>

    <!-- Firebase + ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged,
            signOut 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            doc, 
            setDoc, 
            getDocs, 
            deleteDoc, 
            query, 
            where,
            onSnapshot,
            serverTimestamp
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®
        const firebaseConfig = {
            apiKey: "AIzaSyCOfdNrWquXTJE1t04P3BHqRa5iCI8jHK0",
            authDomain: "calendar-888d2.firebaseapp.com",
            projectId: "calendar-888d2",
            storageBucket: "calendar-888d2.firebasestorage.app",
            messagingSenderId: "778995585586",
            appId: "1:778995585586:web:885962728d935d7c1da22b",
            measurementId: "G-JHKNCR2WTS"
        };

        // Firebase ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤‡¶æ‡¶á‡¶ú
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤
        let currentUser = null;
        let alarms = [];
        let currentAlarm = null;
        let alarmInterval = null;
        let volume = 50;
        let selectedSound = 'classic';
        let permissionGranted = false;

        // Sound URLs
        const soundUrls = {
            classic: "https://assets.mixkit.co/sfx/preview/mixkit-classic-alarm-995.mp3",
            digital: "https://assets.mixkit.co/sfx/preview/mixkit-digital-clock-digital-alarm-buzzer-992.mp3",
            beep: "https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3",
            bell: "https://assets.mixkit.co/sfx/preview/mixkit-bell-notification-933.mp3",
            chime: "https://assets.mixkit.co/sfx/preview/mixkit-morning-clock-alarm-1003.mp3",
            siren: "https://assets.mixkit.co/sfx/preview/mixkit-siren-alert-994.mp3"
        };

        // Sound ‡¶¨‡¶æ‡¶ü‡¶® ‡¶≤‡ßã‡¶°
        function loadSoundButtons() {
            const soundButtons = document.getElementById('soundButtons');
            const sounds = [
                {id: 'classic', name: '‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡¶ø‡¶ï', emoji: 'üîî'},
                {id: 'digital', name: '‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤', emoji: 'üìü'},
                {id: 'beep', name: '‡¶¨‡¶ø‡¶™', emoji: 'üîä'},
                {id: 'bell', name: '‡¶¨‡ßá‡¶≤', emoji: 'üîî'},
                {id: 'chime', name: '‡¶ö‡¶æ‡¶á‡¶Æ', emoji: 'üéµ'},
                {id: 'siren', name: '‡¶∏‡¶æ‡¶á‡¶∞‡ßá‡¶®', emoji: 'üö®'}
            ];
            
            soundButtons.innerHTML = '';
            sounds.forEach(sound => {
                const btn = document.createElement('button');
                btn.className = `sound-btn ${selectedSound === sound.id ? 'active-sound' : ''}`;
                btn.innerHTML = `${sound.emoji} ${sound.name}`;
                btn.onclick = () => selectSound(sound.id);
                soundButtons.appendChild(btn);
            });
        }

        // Sound ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü
        function selectSound(soundId) {
            selectedSound = soundId;
            document.getElementById('alarmSound').value = soundId;
            loadSoundButtons();
            testSound(soundId);
        }

        // Sound ‡¶ü‡ßá‡¶∏‡ßç‡¶ü
        function testSound(soundId) {
            const audio = document.getElementById(`sound${soundId.charAt(0).toUpperCase() + soundId.slice(1)}`);
            if (audio) {
                audio.currentTime = 0;
                audio.volume = volume / 100;
                audio.play().catch(e => {
                    console.log('Sound error:', e);
                    alert('Sound ‡¶™‡ßç‡¶≤‡ßá ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                });
            }
        }

        // ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶° Sound ‡¶ü‡ßá‡¶∏‡ßç‡¶ü
        function testSelectedSound() {
            const soundId = document.getElementById('alarmSound').value;
            testSound(soundId);
        }

        // ‡¶≠‡¶≤‡¶ø‡¶â‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        function updateVolume() {
            volume = document.getElementById('volumeSlider').value;
            document.getElementById('volumeValue').textContent = `${volume}%`;
            
            // ‡¶∏‡¶¨ ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶≠‡¶≤‡¶ø‡¶â‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            const sounds = ['Classic', 'Digital', 'Beep', 'Bell', 'Chime', 'Siren'];
            sounds.forEach(sound => {
                const audio = document.getElementById(`sound${sound}`);
                if (audio) {
                    audio.volume = volume / 100;
                }
            });
        }

        // ‡¶Ö‡¶•‡ßá‡¶®‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡ßá‡¶ü
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                checkNotificationPermission();
                loadAlarmsFromFirebase();
                setupAlarmListener();
            } else {
                currentUser = null;
                alarms = [];
                updateAlarmUI();
            }
        });

        // ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ö‡ßá‡¶ï
        function checkNotificationPermission() {
            if (!("Notification" in window)) {
                showPermissionWarning("‡¶è‡¶á ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ");
                permissionGranted = false;
                return;
            }
            
            if (Notification.permission === "granted") {
                permissionGranted = true;
                document.getElementById('permissionWarning').style.display = 'none';
            } else if (Notification.permission === "denied") {
                showPermissionWarning("‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶°‡¶ø‡¶®‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡¶ø‡¶®‡•§");
                permissionGranted = false;
            } else {
                requestNotificationPermission();
            }
        }

        // ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü
        function requestNotificationPermission() {
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    permissionGranted = true;
                    document.getElementById('permissionWarning').style.display = 'none';
                } else {
                    showPermissionWarning("‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ‡•§");
                    permissionGranted = false;
                }
            });
        }

        // ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç
        function showPermissionWarning(message) {
            const warning = document.getElementById('permissionWarning');
            warning.innerHTML = `‚ö†Ô∏è ${message} <button onclick="requestNotificationPermission()" style="background:#00ff88; color:black; border:none; padding:5px 10px; border-radius:5px; margin-left:10px; cursor:pointer;">‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡¶ø‡¶®</button>`;
            warning.style.display = 'block';
        }

        // Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶≤‡ßã‡¶°
        async function loadAlarmsFromFirebase() {
            if (!currentUser) return;
            
            try {
                const q = query(collection(db, 'users', currentUser.uid, 'alarms'));
                const querySnapshot = await getDocs(q);
                
                alarms = [];
                querySnapshot.forEach(doc => {
                    alarms.push({ id: doc.id, ...doc.data() });
                });
                
                updateAlarmUI();
                startAlarmChecker();
            } catch (error) {
                console.error('Alarm load error:', error);
            }
        }

        // ‡¶∞‡¶ø‡ßü‡ßá‡¶≤‡¶ü‡¶æ‡¶á‡¶Æ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
        function setupAlarmListener() {
            if (!currentUser) return;
            
            const q = query(collection(db, 'users', currentUser.uid, 'alarms'));
            onSnapshot(q, (snapshot) => {
                alarms = [];
                snapshot.forEach(doc => {
                    alarms.push({ id: doc.id, ...doc.data() });
                });
                updateAlarmUI();
            });
        }

        // ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®
        function openAlarmModal() {
            document.getElementById('alarmModal').style.display = 'block';
            loadAlarmsToList();
            
            // Repeat select change handler
            document.getElementById('alarmRepeat').onchange = function() {
                document.getElementById('customDays').style.display = 
                    this.value === 'custom' ? 'block' : 'none';
            };
        }

        // ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®
        function closeAlarmModal() {
            document.getElementById('alarmModal').style.display = 'none';
        }

        // ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
        async function saveAlarm() {
            if (!currentUser) {
                alert('‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
                return;
            }
            
            const time = document.getElementById('alarmTime').value;
            const reason = document.getElementById('alarmReason').value.trim();
            const repeat = document.getElementById('alarmRepeat').value;
            const sound = document.getElementById('alarmSound').value;
            
            if (!time || !reason) {
                alert('‡¶∏‡¶Æ‡ßü ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®');
                return;
            }
            
            // Custom days collect
            let customDays = [];
            if (repeat === 'custom') {
                const checkboxes = document.querySelectorAll('input[name="day"]:checked');
                checkboxes.forEach(cb => customDays.push(parseInt(cb.value)));
                if (customDays.length === 0) {
                    alert('‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¶‡¶ø‡¶® ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®');
                    return;
                }
            }
            
            const alarmId = `alarm_${Date.now()}`;
            const alarmData = {
                id: alarmId,
                time: time,
                reason: reason,
                repeat: repeat,
                sound: sound,
                customDays: customDays,
                active: true,
                createdAt: serverTimestamp(),
                userId: currentUser.uid,
                nextTrigger: calculateNextTrigger(time, repeat, customDays)
            };
            
            try {
                await setDoc(doc(db, 'users', currentUser.uid, 'alarms', alarmId), alarmData);
                
                // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞
                document.getElementById('alarmTime').value = '';
                document.getElementById('alarmReason').value = '';
                document.getElementById('customDays').style.display = 'none';
                
                alert('‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            } catch (error) {
                console.error('Alarm save error:', error);
                alert('‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            }
        }
      
      // ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶ü‡ßç‡¶∞‡¶ø‡¶ó‡¶æ‡¶∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü
        function calculateNextTrigger(time, repeat, customDays = []) {
            const now = new Date();
            const [hours, minutes] = time.split(':');
            const alarmTime = new Date();
            alarmTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
            
            // ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶™‡¶æ‡¶∞ ‡¶π‡ßü‡ßá ‡¶ó‡¶ø‡ßü‡ßá ‡¶•‡¶æ‡¶ï‡ßá
            if (alarmTime < now) {
                alarmTime.setDate(alarmTime.getDate() + 1);
            }
            
            // Repeat logic
            if (repeat === 'once') {
                return alarmTime.getTime();
            }
            
            if (repeat === 'daily') {
                return alarmTime.getTime();
            }
            
            if (repeat === 'weekdays') {
                while ([0, 6].includes(alarmTime.getDay())) {
                    alarmTime.setDate(alarmTime.getDate() + 1);
                }
                return alarmTime.getTime();
            }
            
            if (repeat === 'weekends') {
                while (![0, 6].includes(alarmTime.getDay())) {
                    alarmTime.setDate(alarmTime.getDate() + 1);
                }
                return alarmTime.getTime();
            }
            
            if (repeat === 'weekly') {
                return alarmTime.getTime();
            }
            
            if (repeat === 'custom' && customDays.length > 0) {
                while (!customDays.includes(alarmTime.getDay())) {
                    alarmTime.setDate(alarmTime.getDate() + 1);
                }
                return alarmTime.getTime();
            }
            
            return alarmTime.getTime();
        }

        // ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶°
        function loadAlarmsToList() {
            const alarmList = document.getElementById('alarmList');
            
            if (alarms.length === 0) {
                alarmList.innerHTML = '<p style="color:#888; text-align:center; padding:20px;">‡¶ï‡ßã‡¶® ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶®‡ßá‡¶á</p>';
                return;
            }
            
            alarmList.innerHTML = '';
            
            alarms.forEach(alarm => {
                const alarmItem = document.createElement('div');
                alarmItem.className = 'alarm-item';
                
                const repeatText = getRepeatText(alarm.repeat, alarm.customDays);
                const soundText = getSoundText(alarm.sound);
                
                alarmItem.innerHTML = `
                    <div class="alarm-time">üïê ${alarm.time}</div>
                    <div class="alarm-reason">üìù ${alarm.reason}</div>
                    <div class="alarm-days">
                        ${repeatText} | ${soundText}
                    </div>
                    <div class="alarm-actions">
                        <button class="delete-alarm" onclick="deleteAlarm('${alarm.id}')">
                            ‚ùå ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü
                        </button>
                        <button style="background:#333; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; font-size:14px;" onclick="testAlarmSound('${alarm.sound}')">
                            üîä ‡¶ü‡ßá‡¶∏‡ßç‡¶ü
                        </button>
                    </div>
                `;
                
                alarmList.appendChild(alarmItem);
            });
        }

        // Repeat ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü
        function getRepeatText(repeat, customDays = []) {
            const texts = {
                'once': '‡¶è‡¶ï‡¶¨‡¶æ‡¶∞',
                'daily': '‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶®',
                'weekdays': '‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ï‡¶∞‡ßç‡¶Æ‡¶¶‡¶ø‡¶¨‡¶∏',
                'weekends': '‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶õ‡ßÅ‡¶ü‡¶ø‡¶∞ ‡¶¶‡¶ø‡¶®',
                'weekly': '‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï',
                'custom': '‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶¶‡¶ø‡¶®'
            };
            
            let text = texts[repeat] || repeat;
            
            if (repeat === 'custom' && customDays.length > 0) {
                const dayNames = ['‡¶∞‡¶¨‡¶ø', '‡¶∏‡ßã‡¶Æ', '‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤', '‡¶¨‡ßÅ‡¶ß', '‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø', '‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞', '‡¶∂‡¶®‡¶ø'];
                const days = customDays.map(day => dayNames[day]).join(', ');
                text = `‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶¶‡¶ø‡¶®: ${days}`;
            }
            
            return text;
        }

        // Sound ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü
        function getSoundText(sound) {
            const texts = {
                'classic': '‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡¶ø‡¶ï',
                'digital': '‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤',
                'beep': '‡¶¨‡¶ø‡¶™',
                'bell': '‡¶¨‡ßá‡¶≤',
                'chime': '‡¶ö‡¶æ‡¶á‡¶Æ',
                'siren': '‡¶∏‡¶æ‡¶á‡¶∞‡ßá‡¶®'
            };
            return texts[sound] || sound;
        }

        // ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü
        async function deleteAlarm(alarmId) {
            if (!confirm('‡¶è‡¶á ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) return;
            
            try {
                await deleteDoc(doc(db, 'users', currentUser.uid, 'alarms', alarmId));
            } catch (error) {
                console.error('Delete error:', error);
                alert('‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            }
        }

        // ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ Sound ‡¶ü‡ßá‡¶∏‡ßç‡¶ü
        function testAlarmSound(soundId) {
            testSound(soundId);
        }

        // UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        function updateAlarmUI() {
            const activeAlarms = alarms.filter(alarm => alarm.active);
            document.getElementById('activeAlarms').textContent = activeAlarms.length;
            
            // ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ
            const now = Date.now();
            const upcomingAlarms = activeAlarms
                .filter(alarm => alarm.nextTrigger > now)
                .sort((a, b) => a.nextTrigger - b.nextTrigger);
            
            if (upcomingAlarms.length > 0) {
                const nextAlarm = upcomingAlarms[0];
                const nextTime = new Date(nextAlarm.nextTrigger);
                const timeStr = nextTime.toLocaleTimeString('bn-BD', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                document.getElementById('nextAlarmInfo').innerHTML = `
                    <strong style="color:#ff9500">‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ:</strong><br>
                    üïê ${timeStr} - ${nextAlarm.reason}<br>
                    <small style="color:#aaa">${getRepeatText(nextAlarm.repeat, nextAlarm.customDays)}</small>
                `;
            } else {
                document.getElementById('nextAlarmInfo').innerHTML = '‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ: ‡¶®‡ßá‡¶á';
            }
        }

        // ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ö‡ßá‡¶ï‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
        function startAlarmChecker() {
            if (alarmInterval) clearInterval(alarmInterval);
            
            alarmInterval = setInterval(() => {
                checkAlarms();
            }, 60000); // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá ‡¶ö‡ßá‡¶ï
            
            // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ö‡ßá‡¶ï
            checkAlarms();
        }

        // ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ö‡ßá‡¶ï
        function checkAlarms() {
            if (!permissionGranted) return;
            
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            const currentDay = now.getDay();
            
            alarms.forEach(alarm => {
                if (!alarm.active) return;
                
                const [hours, minutes] = alarm.time.split(':');
                const alarmTime = parseInt(hours) * 60 + parseInt(minutes);
                
                // ‡¶∏‡¶Æ‡ßü ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ
                if (Math.abs(currentTime - alarmTime) <= 1) {
                    // Repeat ‡¶ö‡ßá‡¶ï
                    if (shouldTriggerAlarm(alarm, currentDay)) {
                        triggerAlarm(alarm);
                    }
                }
            });
        }

        // ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ü‡ßç‡¶∞‡¶ø‡¶ó‡¶æ‡¶∞ ‡¶π‡¶ì‡ßü‡¶æ ‡¶â‡¶ö‡¶ø‡¶§ ‡¶ï‡¶ø‡¶®‡¶æ
        function shouldTriggerAlarm(alarm, currentDay) {
            if (alarm.repeat === 'once') return true;
            if (alarm.repeat === 'daily') return true;
            if (alarm.repeat === 'weekdays') return currentDay >= 1 && currentDay <= 5;
            if (alarm.repeat === 'weekends') return currentDay === 0 || currentDay === 6;
            if (alarm.repeat === 'weekly') return true;
            if (alarm.repeat === 'custom') {
                return alarm.customDays && alarm.customDays.includes(currentDay);
            }
            return true;
        }

        // ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ü‡ßç‡¶∞‡¶ø‡¶ó‡¶æ‡¶∞
        function triggerAlarm(alarm) {
            currentAlarm = alarm;
            
            // Sound ‡¶¨‡¶æ‡¶ú‡¶æ‡¶ì
            playAlarmSound(alarm.sound);
            
            // ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì
            showAlarmNotification(alarm.reason);
            
            // ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®
            if (Notification.permission === "granted") {
                new Notification("üîî ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ!", {
                    body: alarm.reason,
                    icon: "https://cdn-icons-png.flaticon.com/512/3208/3208720.png",
                    tag: "usdt-alarm"
                });
            }
            
            // Firebase-‡¶è ‡¶≤‡¶ó
            if (currentUser) {
                logAlarmTrigger(alarm.id);
            }
        }

        // Alarm sound ‡¶¨‡¶æ‡¶ú‡¶æ‡¶ì
        function playAlarmSound(soundId) {
            const audio = document.getElementById('currentAlarmSound');
            audio.src = soundUrls[soundId];
            audio.volume = volume / 100;
            audio.loop = true;
            
            audio.play().catch(e => {
                console.log('Alarm sound error:', e);
                // Fallback to embedded sound
                testSound(soundId);
            });
        }

        // ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì
        function showAlarmNotification(message) {
            document.getElementById('notificationTitle').textContent = '‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ!';
            document.getElementById('notificationMessage').textContent = message;
            document.getElementById('alarmNotification').style.display = 'block';
            
            // 30 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Ö‡¶ü‡ßã ‡¶¨‡¶®‡ßç‡¶ß
            setTimeout(() => {
                if (document.getElementById('alarmNotification').style.display === 'block') {
                    stopAlarm();
                }
            }, 30000);
        }

        // ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶∏‡ßç‡¶ü‡¶™
        function stopAlarm() {
            const audio = document.getElementById('currentAlarmSound');
            audio.pause();
            audio.currentTime = 0;
            document.getElementById('alarmNotification').style.display = 'none';
            currentAlarm = null;
        }

        // ‡¶∏‡ßç‡¶®‡ßÅ‡¶ú
        function snoozeAlarm() {
            stopAlarm();
            setTimeout(() => {
                if (currentAlarm) {
                    triggerAlarm(currentAlarm);
                }
            }, 5 * 60 * 1000); // 5 ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü
        }

        // Firebase-‡¶è ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶Æ ‡¶≤‡¶ó
        async function logAlarmTrigger(alarmId) {
            if (!currentUser) return;
            
            try {
                await setDoc(doc(db, 'users', currentUser.uid, 'alarm_logs', `log_${Date.now()}`), {
                    alarmId: alarmId,
                    triggeredAt: serverTimestamp()
                });
            } catch (error) {
                console.error('Log error:', error);
            }
        }

        // ‡¶™‡ßá‡¶á‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá
        document.addEventListener('DOMContentLoaded', () => {
            loadSoundButtons();
            updateVolume();
            
            // ‡¶≠‡¶≤‡¶ø‡¶â‡¶Æ ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü
            document.getElementById('volumeSlider').addEventListener('input', updateVolume);
            
            // Repeat select change
            document.getElementById('alarmRepeat').addEventListener('change', function() {
                document.getElementById('customDays').style.display = 
                    this.value === 'custom' ? 'block' : 'none';
            });
        });

        // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        window.openAlarmModal = openAlarmModal;
        window.closeAlarmModal = closeAlarmModal;
        window.saveAlarm = saveAlarm;
        window.deleteAlarm = deleteAlarm;
        window.testSelectedSound = testSelectedSound;
        window.testAlarmSound = testAlarmSound;
        window.requestNotificationPermission = requestNotificationPermission;
        window.updateVolume = updateVolume;
        window.stopAlarm = stopAlarm;
        window.snoozeAlarm = snoozeAlarm;
        window.selectSound = selectSound;

        // ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶¨‡¶®‡ßç‡¶ß
        window.onclick = function(event) {
            if (event.target.id === 'alarmModal') {
                closeAlarmModal();
            }
        };
    </script>
</body>
</html>
